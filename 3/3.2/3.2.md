# 3.2. Modelo de Coordinación

El modelo de coordinación para la aplicación de seguimiento de hábitos está diseñado para facilitar la interacción eficiente entre los diversos módulos del sistema, asegurando una experiencia fluida para el usuario y el cumplimiento de los requisitos funcionales.

## Modelo y ADR
**Identificación de Elementos y sus Interacciones**

- Módulos Interactuantes:

  - Módulo de Usuarios: Coordina el registro, inicio de sesión y gestión de perfiles.
  - Módulo de Hábitos: Interactúa con el Módulo de Usuarios para asociar hábitos a cada usuario.
  - Módulo de Seguimiento: Depende de los Módulos de Usuarios y Hábitos para registrar y visualizar el progreso.
  - Módulo de Motivación: Se integra con el Módulo de Usuarios para enviar notificaciones y mensajes motivacionales.
  - Módulo de Amigos: Coordina la búsqueda y conexión entre usuarios, así como el seguimiento del progreso.
  - Módulo de Chat: Facilita la comunicación entre usuarios y grupos, interactuando con todos los demás módulos para recibir y enviar mensajes.
- Interacciones Prohibidas: No se permiten interacciones directas entre el Módulo de Chat y el Módulo de Hábitos para evitar la mezcla de datos y mantener la coherencia en la información.

**Propiedades de la Coordinación**
  - Oportunidad: La comunicación entre módulos debe ser en tiempo real, especialmente en los Módulos de Amigos y Chat, donde la interacción rápida es clave.
  - Frecuencia: Las actualizaciones de hábitos y progreso deben ser enviadas y recibidas en intervalos cortos (por ejemplo: cada vez que se complete un hábito).
  - Completitud: Es necesario asegurar que todos los datos relevantes se transmitan entre los módulos sin pérdidas.
  - Consistencia: Los datos deben ser consistentes en todos los módulos, garantizando que cualquier cambio en el Módulo de Hábitos se refleje inmediatamente en el Módulo de Seguimiento.
    
**Mecanismos de Comunicación**

- **Interacción Interna:**

  - Síncrono: Se utilizarán llamadas API RESTful entre módulos dentro de la aplicación para obtener información actualizada, por ejemplo, al iniciar sesión o registrar hábitos completados.
  - Asíncrono: Se implementará WebSocket en el Módulo de Chat para permitir la mensajería en tiempo real entre usuarios.

- Integración con Sistemas Externos: La aplicación puede integrarse con sistemas de notificación (como Firebase Cloud Messaging) para enviar alertas y mensajes motivacionales.

**Propiedades de los Mecanismos de Comunicación**
  - Stateful vs. Stateless: Se opta por un enfoque stateless para las interacciones entre módulos, manteniendo la simplicidad y escalabilidad del sistema. El estado se maneja en el cliente para la mayoría de las interacciones.
  - Síncrono vs. Asíncrono: Se emplearán ambos tipos según el contexto; las interacciones críticas (como inicio de sesión) serán síncronas, mientras que las interacciones de chat serán asíncronas para permitir una experiencia fluida.
  - Latencia: Se buscará minimizar la latencia en todas las comunicaciones, especialmente en la mensajería y notificaciones, para asegurar una respuesta rápida.
  - Throughput: El sistema está diseñado para manejar un alto throughput, especialmente en el Módulo de Chat, donde se espera que múltiples usuarios se comuniquen simultáneamente.



# ADR (Architectural Decision Record): Modelo de Coordinación de la Aplicación de Seguimiento de Hábitos

## Contexto
La aplicación de seguimiento de hábitos está diseñada para permitir a los usuarios gestionar hábitos, realizar un seguimiento de su progreso, comunicarse con amigos, y recibir notificaciones y mensajes motivacionales. El sistema debe soportar interacciones en tiempo real, como la mensajería instantánea y las actualizaciones del progreso, a la vez que garantiza la coherencia de los datos en módulos críticos como la autenticación y la gestión de hábitos.

### Tecnologías Utilizadas:

1. **Frontend**: React Native
2. **Backend**: Node.js con Express.js
3. **Base de datos**: 
   - **PostgreSQL** para el manejo de datos estructurados (usuarios, hábitos, progreso).
   - **Apache Cassandra** para el almacenamiento de mensajes de chat.
   - **Amazon S3** para contenido multimedia (imágenes, archivos de audio).

La interacción entre estos módulos debe ser rápida y eficiente, minimizando la latencia y asegurando la escalabilidad, ya que se espera que un número considerable de usuarios utilicen la aplicación simultáneamente.

---

## Decisión

Se decidió implementar un **modelo de coordinación mixto**, utilizando tanto **comunicación síncrona** como **asíncrona** dependiendo de las necesidades de los módulos, y adoptando un enfoque **stateless** para la mayoría de las interacciones, de modo que el sistema sea escalable y fácil de mantener.

1. **Comunicación síncrona (API RESTful a través de Express.js)**:
   - Se utilizará para las interacciones que requieren respuestas inmediatas y consistentes, como la gestión de usuarios, autenticación, y la actualización de hábitos y seguimiento. Estas interacciones son críticas y deben garantizar la coherencia en el sistema.
   
2. **Comunicación asíncrona (WebSockets)**:
   - Se implementará en el **Módulo de Chat** y las **notificaciones en tiempo real**, permitiendo una experiencia fluida en la mensajería instantánea y las alertas sin demoras innecesarias.
   
3. **Almacenamiento distribuido**:
   - **PostgreSQL** gestionará los datos transaccionales y estructurados como la información de usuarios, hábitos y progreso.
   - **Apache Cassandra** manejará el almacenamiento de mensajes de chat, optimizando el rendimiento de escritura en grandes volúmenes de datos.
   - **Amazon S3** será utilizado para almacenar contenido multimedia, aprovechando su escalabilidad y capacidad de almacenamiento.

---

## Alternativas Consideradas

### 1. Modelo completamente síncrono  
Utilizar solo API RESTful para manejar todas las interacciones entre los módulos.

**Ventajas**:
- Simplicidad de implementación y mantenimiento.
- Control total sobre la sincronización de datos en tiempo real.

**Desventajas**:
- No es adecuado para módulos que requieren respuestas en tiempo real, como el chat y las notificaciones, donde la latencia debe ser baja.
- Mayor riesgo de **cuellos de botella** en situaciones de alta demanda.

### 2. Modelo completamente asíncrono  
Usar WebSockets o colas de mensajes para gestionar todas las interacciones entre los módulos.

**Ventajas**:
- Excelente para manejar grandes volúmenes de usuarios y datos en tiempo real.
- Baja latencia para las interacciones críticas como el chat.

**Desventajas**:
- Mayor complejidad de implementación y riesgos en la consistencia de los datos, especialmente en la gestión de usuarios y hábitos, donde se requieren respuestas inmediatas y coherentes.
- Mayor carga de procesamiento en la lógica de eventos.

---

## Razonamiento

Se eligió un **modelo mixto** porque permite aprovechar las ventajas de ambas opciones:

- **Síncrono**: Es vital para asegurar que la aplicación mantenga la **consistencia de los datos críticos** como los usuarios, hábitos y progreso. Los módulos relacionados con la gestión de datos persistentes se benefician de llamadas API RESTful que garantizan coherencia en las actualizaciones.
  
- **Asíncrono**: Optimiza la interacción en tiempo real en módulos como **Chat** y **Notificaciones**, donde la respuesta rápida es fundamental para una experiencia de usuario fluida. La mensajería y notificaciones se manejan de forma más eficiente mediante WebSockets.

- **Stateful vs. Stateless**: Se opta por un enfoque **stateless** en la mayoría de las interacciones, lo que simplifica la escalabilidad y permite manejar múltiples usuarios de forma eficiente. El estado se gestionará principalmente del lado del cliente, y solo se mantendrá en el servidor donde sea necesario, como en la autenticación de usuarios.

---

## Consecuencias

1. **Escalabilidad**: Este modelo asegura que el sistema puede crecer de forma eficiente, tanto en términos de manejo de usuarios como en la capacidad de procesar datos en tiempo real. La separación de responsabilidades entre las bases de datos relacionales y no relacionales facilita la gestión de grandes volúmenes de datos.
  
2. **Experiencia de usuario fluida**: Los usuarios tendrán una experiencia de mensajería y notificaciones sin interrupciones, gracias al uso de WebSockets en los módulos de tiempo real.

3. **Consistencia en datos críticos**: Los módulos síncronos garantizarán que las actualizaciones de hábitos y la información de usuarios estén siempre sincronizados, evitando problemas de coherencia de datos.

4. **Mayor esfuerzo de implementación**: Este modelo mixto requiere una mayor coordinación entre los distintos mecanismos de comunicación, lo que implicará un esfuerzo adicional en términos de pruebas y mantenimiento.

---

## Decisiones Futuras

A medida que la base de usuarios crezca, es posible que necesitemos escalar más nuestra infraestructura de backend. Podríamos considerar la introducción de **colas de mensajes** para manejar mejor la carga de trabajo en el **Módulo de Chat** y las notificaciones, en lugar de depender únicamente de WebSockets para todas las interacciones en tiempo real. Asimismo, podríamos revisar la necesidad de un sistema de **autenticación distribuida** si el sistema de usuarios experimenta una carga significativamente mayor.
