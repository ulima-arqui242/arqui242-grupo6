# 3.2. Modelo de Coordinación


## ADR


### Titulo:

Elección del modelo de interacción para la aplicación de seguimiento de hábitos

### Contexto:  
La aplicación de seguimiento de hábitos está diseñada para permitir a los usuarios gestionar hábitos, realizar un seguimiento de su progreso, comunicarse con amigos y recibir notificaciones y mensajes motivacionales. El sistema debe soportar interacciones en tiempo real, como la mensajería instantánea y las actualizaciones de progreso, garantizando la coherencia de los datos en módulos críticos como la autenticación y la gestión de hábitos.

**Tecnologías Utilizadas**:

- **Frontend**: React Native
- **Backend**: Node.js con Express.js
- **Base de datos**: 
   - **PostgreSQL** para el manejo de datos estructurados (usuarios, hábitos, progreso).
   - **Apache Cassandra** para el almacenamiento de mensajes de chat.
   - **Amazon S3** para contenido multimedia (imágenes, archivos de audio).

La interacción entre estos módulos debe ser rápida y eficiente, minimizando la latencia y asegurando la escalabilidad, ya que se espera que un número considerable de usuarios utilice la aplicación simultáneamente.


## Alternativas

### 1. Modelo completamente síncrono
Utilizar solo API RESTful para manejar todas las interacciones entre los módulos.

- **Ventajas**:  
  - Simplicidad de implementación y mantenimiento.
  - Control total sobre la sincronización de datos en tiempo real.

- **Desventajas**:  
  - No es adecuado para módulos que requieren respuestas en tiempo real, como el chat y las notificaciones, donde la latencia debe ser baja.
  - Mayor riesgo de cuellos de botella en situaciones de alta demanda, lo que podría afectar la experiencia del usuario.

### 2. Modelo completamente asíncrono  
Usar WebSockets o colas de mensajes para gestionar todas las interacciones entre los módulos.

- **Ventajas**:  
  - Excelente para manejar grandes volúmenes de usuarios y datos en tiempo real.
  - Baja latencia para las interacciones críticas como el chat.

- **Desventajas**:  
  - Mayor complejidad de implementación y riesgos en la consistencia de los datos, especialmente en la gestión de usuarios y hábitos, donde se requieren respuestas inmediatas y coherentes.
  - Mayor carga de procesamiento en la lógica de eventos, lo que puede complicar la arquitectura general.

### 3. Modelo mixto (Síncrono y Asíncrono)  
Combinar comunicación síncrona (API RESTful) para módulos que requieren consistencia de datos con comunicación asíncrona (WebSockets) para módulos de tiempo real como Chat y Notificaciones.

- **Ventajas**:  
  - Combina lo mejor de ambos enfoques, proporcionando consistencia y bajo tiempo de respuesta donde sea necesario.
  - Escalabilidad y flexibilidad para manejar tanto datos críticos como interacciones en tiempo real.

- **Desventajas**:  
  - Mayor esfuerzo en la coordinación de distintos mecanismos de comunicación.
  - Requiere pruebas adicionales para asegurar que los módulos se sincronicen correctamente.


## Criterios de Elección
- **Consistencia de Datos**: Necesitamos garantizar que los módulos de gestión de usuarios, hábitos y progreso mantengan coherencia en los datos, especialmente en transacciones críticas como el registro y actualización de hábitos.
- **Rendimiento en Tiempo Real**: Las interacciones de chat y notificaciones requieren baja latencia y capacidad para manejar múltiples usuarios concurrentes sin retrasos.
- **Escalabilidad**: Dado que la aplicación está diseñada para un gran número de usuarios simultáneos, el sistema debe escalar de manera eficiente y evitar cuellos de botella.
- **Simplicidad de Implementación**: Aunque buscamos un sistema escalable y rápido, la simplicidad en la implementación es clave, considerando el tamaño del equipo y los tiempos ajustados.


## Decisión Final
Se decidió implementar un **modelo de coordinación mixto**, utilizando tanto **comunicación síncrona** (API RESTful) como **comunicación asíncrona** (WebSockets), asegurando un enfoque **stateless** en la mayoría de las interacciones para mejorar la escalabilidad y el rendimiento.


## Sustento
La elección de un **modelo mixto** nos permite garantizar la **consistencia de datos** en los módulos críticos a través del uso de API RESTful, asegurando que las transacciones sean coherentes. Al mismo tiempo, la implementación de WebSockets para las interacciones en tiempo real proporciona una experiencia fluida en el módulo de Chat y Notificaciones, minimizando la latencia. Este enfoque **stateless** distribuye la carga entre diferentes mecanismos de almacenamiento y facilita la escalabilidad del sistema a medida que crece el número de usuarios. La flexibilidad del modelo mixto también permite la integración de nuevas funcionalidades en el futuro sin afectar la arquitectura existente, asegurando un desarrollo sostenible y ágil.



## Modelo

El modelo de coordinación para la aplicación de seguimiento de hábitos está diseñado para facilitar la interacción eficiente entre los diversos módulos del sistema, asegurando una experiencia fluida para el usuario y el cumplimiento de los requisitos funcionales.

**Identificación de Elementos y sus Interacciones**

- Módulos Interactuantes:

  - Módulo de Usuarios: Coordina el registro, inicio de sesión y gestión de perfiles.
  - Módulo de Hábitos: Interactúa con el Módulo de Usuarios para asociar hábitos a cada usuario.
  - Módulo de Seguimiento: Depende de los Módulos de Usuarios y Hábitos para registrar y visualizar el progreso.
  - Módulo de Motivación: Se integra con el Módulo de Usuarios para enviar notificaciones y mensajes motivacionales.
  - Módulo de Amigos: Coordina la búsqueda y conexión entre usuarios, así como el seguimiento del progreso.
  - Módulo de Chat: Facilita la comunicación entre usuarios y grupos, interactuando con todos los demás módulos para recibir y enviar mensajes.
- Interacciones Prohibidas: No se permiten interacciones directas entre el Módulo de Chat y el Módulo de Hábitos para evitar la mezcla de datos y mantener la coherencia en la información.

**Propiedades de la Coordinación**
  - Oportunidad: La comunicación entre módulos debe ser en tiempo real, especialmente en los Módulos de Amigos y Chat, donde la interacción rápida es clave.
  - Frecuencia: Las actualizaciones de hábitos y progreso deben ser enviadas y recibidas en intervalos cortos (por ejemplo: cada vez que se complete un hábito).
  - Completitud: Es necesario asegurar que todos los datos relevantes se transmitan entre los módulos sin pérdidas.
  - Consistencia: Los datos deben ser consistentes en todos los módulos, garantizando que cualquier cambio en el Módulo de Hábitos se refleje inmediatamente en el Módulo de Seguimiento.
    
**Mecanismos de Comunicación**

- **Interacción Interna:**

  - Síncrono: Se utilizarán llamadas API RESTful entre módulos dentro de la aplicación para obtener información actualizada, por ejemplo, al iniciar sesión o registrar hábitos completados.
  - Asíncrono: Se implementará WebSocket en el Módulo de Chat para permitir la mensajería en tiempo real entre usuarios.

- Integración con Sistemas Externos: La aplicación puede integrarse con sistemas de notificación (como Firebase Cloud Messaging) para enviar alertas y mensajes motivacionales.

**Propiedades de los Mecanismos de Comunicación**
  - Síncrono y Asíncrono: Se emplearán ambos tipos según el contexto; las interacciones críticas (como inicio de sesión) serán síncronas, mientras que las interacciones de chat serán asíncronas para permitir una experiencia fluida.
  - Latencia: Se buscará minimizar la latencia en todas las comunicaciones, especialmente en la mensajería y notificaciones, para asegurar una respuesta rápida.
  - Throughput: El sistema está diseñado para manejar un alto throughput, especialmente en el Módulo de Chat, donde se espera que múltiples usuarios se comuniquen simultáneamente.







